<div class="details-container" *ngIf="narrativeDetails && !errorMessage">
  <div class="card-container">
    <mat-card class="pg-data-card">
      <div class="deceased-info-title">Deceased Information</div>
      <div class="deceased-info-grid">
        <div class="info-item">
          <span class="label">Deceased Name:</span>
          <span class="value">{{ narrativeDetails.pgData.name }}</span>
        </div>
        <div class="info-item">
          <span class="label">CHAMPS ID:</span>
          <span class="value">{{ narrativeDetails.pgData.champsid }}</span>
        </div>
        <div class="info-item">
          <span class="label">HDSS ID:</span>
          <span class="value">{{ narrativeDetails.pgData.hdssid }}</span>
        </div>

        <div class="info-item">
          <span class="label">Date of Birth:</span>
          <span class="value">{{ narrativeDetails.pgData.dob }}</span>
        </div>
        <div class="info-item">
          <span class="label">Date of Death:</span>
          <span class="value">{{ narrativeDetails.pgData.dod }}</span>
        </div>
        <div class="info-item">
          <span class="label">Age:</span>
          <span class="value">{{ formatAge(narrativeDetails.pgData.age, narrativeDetails.pgData.age_unit) }}</span>
        </div>

        <div class="info-item">
          <span class="label">Sex:</span>
          <span class="value">{{ formatSex(narrativeDetails.pgData.sex) }}</span>
        </div>
        <div class="info-item">
          <span class="label">Father/HH Head:</span>
          <span class="value">{{ narrativeDetails.pgData.fat_hhhead }}</span>
        </div>
        <div class="info-item">
          <span class="label">Mother:</span>
          <span class="value">{{ narrativeDetails.pgData.mother }}</span>
        </div>

        <div class="info-item">
          <span class="label">Address:</span>
          <span class="value">{{ narrativeDetails.pgData.adderss }}</span>
        </div>
        <div class="info-item">
          <span class="label">Age Group:</span>
          <span class="value">{{ formatAgeGroup(narrativeDetails.pgData.is_sb, narrativeDetails.pgData.is_neonate, narrativeDetails.pgData.is_child, narrativeDetails.pgData.is_adult) }}</span>
        </div>
        <div class="info-item">
          <span class="label">Interview Date:</span>
          <span class="value">{{ narrativeDetails.pgData.intv_date }}</span>
        </div>

        <div class="info-item">
          <span class="label">Interview Time:</span>
          <span class="value">{{ narrativeDetails.pgData.intv_time }}</span>
        </div>
        <div class="info-item">
          <span class="label">Interview Status:</span>
          <span class="value">{{ formatInterviewStatus(narrativeDetails.pgData.intrv_result) }}</span>
        </div>
        <div class="info-item">
          <span class="label">Consent:</span>
          <span class="value">{{ formatConsent(narrativeDetails.pgData.isconcented) }}</span>
        </div>

        <div class="info-item">
          <span class="label">Data Entry DateTime:</span>
          <span class="value">{{ narrativeDetails.pgData.starttime }}</span>
        </div>
        <div class="info-item">
          <span class="label">System Version:</span>
          <span class="value">{{ narrativeDetails.pgData.version }}</span>
        </div>
        <div class="info-item">
          <span class="label">UUID:</span>
          <span class="value">{{ narrativeDetails.pgData.uuid }}</span>
        </div>
      </div>
    </mat-card>
    <mat-card class="narrative-input-card">
      <div class="narrative-card-title">VASA Narrative</div>
      <div class="narrative-card-content">
        <mat-form-field appearance="fill" class="narrative-field">
          <mat-label style="font-size: 1.35rem; ">VASA Narrative</mat-label>
          <textarea
            matInput
            [(ngModel)]="vasaNarrative"
            (ngModelChange)="onNarrativeChange()"
            rows="9"
            maxlength="10000"
            placeholder="বাংলা বা ইংরেজিতে বিবরণ লিখুন..."></textarea>
          <mat-hint align="end">{{ vasaNarrative?.length || 0 }}/10000</mat-hint>
        </mat-form-field>

        <div class="status-group">
          <label class="status-label">Narrative Status:</label>
          <mat-radio-group
            aria-label="Narrative Status"
            [(ngModel)]="narrativeStatus"
            (ngModelChange)="onNarrativeStatusChange()">
            <mat-radio-button color="primary" value="1" class="me-3">Complete</mat-radio-button>
            <mat-radio-button color="primary" value="2" class="me-3">Incomplete</mat-radio-button>
            <mat-radio-button color="primary" value="3" class="me-3">No Narrative</mat-radio-button>
          </mat-radio-group>
        </div>

        <div class="narrative-actions">
          <button
            mat-raised-button
            color="primary"
            [disabled]="!isSaveButtonEnabled"
            (click)="saveNarrative()"
            *ngIf="canSaveOrUpdate"> <mat-icon>save</mat-icon>
            {{ narrativeDetails?.narrativeData ? 'Update' : 'Save' }}
          </button>
          <button mat-raised-button color="" (click)="goBack()" >  <mat-icon>reply</mat-icon>Back</button>
        </div>
      </div>
    </mat-card>
  </div>
</div>
<mat-card *ngIf="errorMessage" class="error-message-card">
  <div class="error-title">
    <mat-icon color="warn">error_outline</mat-icon>
    Error
  </div>
  <div class="error-content">
    {{ errorMessage }}
  </div>
  <div class="error-actions">
    <button mat-stroked-button color="primary" (click)="goBack()">Back</button>
  </div>
</mat-card>
